<?php
/**
 * @file
 * ITGCMS Image Thumb creation.
 */

/**
 * Implements hook_menu().
 */
function itgcms_image_thumb_menu()

{
$items=array();


$items['itgcmsthumb']=array(
'title'=>'Thumb callback menu',
'page callback'=>'itg_imgthumb',
'access callback' => TRUE,
'type'=>  MENU_CALLBACK,


);

return $items;
}


  /**
 * Function to create image thumb
 */
 function cwUpload($field_name = '', $target_folder = '', $file_name = '', $thumb = FALSE, $thumb_folder = '', $thumb_width = '', $thumb_height = ''){


//folder path setup
	$target_path = $target_folder;
	$thumb_path = $thumb_folder;
	
	//file name setup
	$filename_err = explode(".",$file_name);
	$filename_err_count = count($filename_err);
	 $file_ext = $filename_err[$filename_err_count-1];


	if($file_name != '')
	{
		 $fileName = $file_name;
	}
	

	 $upload_image = $target_path.basename($fileName);

	
		//thumbnail creation
		if($thumb == TRUE)
		{
			  $thumbnail = $thumb_path.$fileName;


			list($width,$height) = getimagesize($upload_image);
			$thumb_create = imagecreatetruecolor($thumb_width,$thumb_height);
			switch($file_ext){
				case 'jpg':
					$source = imagecreatefromjpeg($upload_image);
					break;
				case 'jpeg':
					$source = imagecreatefromjpeg($upload_image);
					break;
				case 'png':
					$source = imagecreatefrompng($upload_image);
					break;
				case 'gif':
					$source = imagecreatefromgif($upload_image);
					break;
				default:
					$source = imagecreatefromjpeg($upload_image);
			}
			imagecopyresized($thumb_create,$source,0,0,0,0,$thumb_width,$thumb_height,$width,$height);
			switch($file_ext){
				case 'jpg' || 'jpeg':
					imagejpeg($thumb_create,$thumbnail,100);
					break;
				case 'png':
					imagepng($thumb_create,$thumbnail,100);
					break;
				case 'gif':
					imagegif($thumb_create,$thumbnail,100);
					break;
				default:
					imagejpeg($thumb_create,$thumbnail,100);
			}
		}

		return $fileName;
}

function itg_imgthumb(){
  
  //main directory path
$upload_dir = DRUPAL_ROOT . '/sites/default/files/photogallery/';

// All Thumb directory path
$thumb=DRUPAL_ROOT . '/sites/default/files/photogallery/thumb_100*100/';
$thumb1=DRUPAL_ROOT . '/sites/default/files/photogallery/thumb_50*50/';
$thumb2=DRUPAL_ROOT . '/sites/default/files/photogallery/thumb_20*20/';


//call Thumb function to create multiple thumb
$upload_img = cwUpload('image',$upload_dir,'images.jpeg',TRUE, $thumb,'100','100');
$upload_img = cwUpload('image',$upload_dir,'images.jpeg',TRUE, $thumb1,'50','50');
$upload_img = cwUpload('image',$upload_dir,'images.jpeg',TRUE, $thumb2,'20','20');
  
}