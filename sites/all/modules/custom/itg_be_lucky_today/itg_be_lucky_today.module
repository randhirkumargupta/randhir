<?php

define('COUNTRY_INDIA_TID', 3383);
/**
 * @file
 * The ITG Be Lucky Today
 *
 * Contains functionality for Be Lucky Today
 *
 */

/**
 * {@inheritdoc}
 * hook_menu()
 * */
function itg_be_lucky_today_menu() {
    $items = array();
    $items['be-lucky-today'] = array(
      'title' => 'Be Lucky Today', //page title
      'description' => 'Be Lucky Today',
      'page callback' => 'drupal_get_form',
      'page arguments' => array('be_lucky_today_form'),
      'access callback' => TRUE,
      'file' => 'inc/itg_be_lucky_today.inc',
    );
    $items['be-lucky-today/terms/%ctools_js'] = array(
      'title' => 'Be Lucky Today', //page title
      'description' => 'Be Lucky Today',
      'page arguments' => array(1),
      'page callback' => 'termscondition_callback',
      'access callback' => TRUE
    );
    $items['be-lucky-today/thankyoupaymentfailed'] = array(
      'title' => 'Be Lucky Today', //page title
      'description' => 'Be Lucky Today',
      'page callback' => 'drupal_get_form',
      'page arguments' => array('thank_you_payment_failed_form'),
      'access callback' => TRUE,
      'file' => 'inc/itg_be_lucky_today.inc',
    );
    $items['be-lucky-today/thankyoupaymentsuccess'] = array(
      'title' => 'Be Lucky Today', //page title
      'description' => 'Be Lucky Today',
      'page callback' => 'drupal_get_form',
      'page arguments' => array('thank_you_payment_success_form'),
      'access callback' => TRUE,
      'file' => 'inc/itg_be_lucky_today.inc',
    );
    $items['be-lucky-today/aftersubscribe'] = array(
      'title' => 'Be Lucky Today', //page title
      'description' => 'Be Lucky Today',
      'page callback' => 'after_subscirbe_callback',
      'access callback' => TRUE,
      'type' => MENU_CALLBACK,
    );
    $items['be-lucky-today/email-confirmation-reference-list'] = array(
      'title' => 'Be Lucky Today', //page title
      'description' => 'Be Lucky Today',
      'page callback' => 'email_confirmation_reference_list_callback',
      'access callback' => TRUE,
      'type' => MENU_CALLBACK,
    );
    $items['be-lucky-today/be-lucky-form'] = array(
      'title' => 'Be Lucky Today', //page title
      'description' => 'Be Lucky Today',
      'page callback' => 'drupal_get_form',
      'page arguments' => array('be_lucky_form'),
      'access callback' => TRUE,
      'file' => 'inc/itg_be_lucky_today.inc',
    );
    return $items;
}

/**
 * 
 * @return array
 */
function itg_be_lucky_today_theme() {
    return array(
      'after_subcribe_theme' => array(
        'template' => 'templates/after_subcribe_template',
      ),
      'email_confirmation_reference_list_theme' => array(
        'template' => 'templates/email_confirmation_reference_list_template',
      ),
      'terms_and_condition_theme' => array(
        'template' => 'templates/terms_and_condition',
      ),
    );
}

/**
 * 
 * @return NULL
 */
function after_subscirbe_callback() {
    if (!isset($_SESSION['be_lucky_today'])) {
        drupal_goto('/be-lucky-today');
    }
    $data = json_decode($_SESSION['be_lucky_today']);
    print theme('after_subcribe_theme', array('data' => $data));
    return NULL;
}

/**
 * 
 * @return array
 */
function email_confirmation_reference_list_callback() {
    drupal_add_js(drupal_get_path('module', 'itg_be_lucky_today') . '/js/itg_be_lucky_today.js');
    return theme('email_confirmation_reference_list_theme');
}

/**
 * {@inheritdoc}
 */
function termscondition_callback($js = NULL) {
    $html = theme('terms_and_condition_theme');
    if ($js) {
        ctools_include('modal');
        ctools_include('ajax');
        $title = t('Be lucky today');
        $build = array(
          '#prefix' => '<strong>',
          '#suffix' => '<strong>',
          '#markup' => $html,
        );
        return ctools_modal_render($title, $build);
    }
    else {
        $output = $html;
        return $output;
    }
}
