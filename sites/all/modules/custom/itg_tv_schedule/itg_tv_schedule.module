<?php
       
/*
 * Implementation of hook_permission()
 */

function itg_tv_schedule_permission() {
    return array(
      'administer my module' => array(
        'title' => t('Administer my module'),
        'description' => t('Permission for TV Schedule upload.'),
      ),
    );
}

/*
 * Implementation of hook_menu()
 */
function itg_tv_schedule_menu() {
    $items = array();

    $items['tv'] = array(
      'title' => 'Upload Tv Schedule',
      'page callback' => 'drupal_get_form',
      'page arguments' => array('itg_tv_schedule_form'),
      'access callback' => TRUE,
      'type' => MENU_CALLBACK,
    );

    return $items;
}

function itg_tv_schedule_form($form, &$form_state) {
  
   $form['file'] = array(
  '#type' => 'managed_file',
  '#title' => t('Tv Schedule Upload'),
  '#description' => t('Allowed extensions: csv'),
  
  '#upload_location' => 'public://',
  '#upload_validators' => array(
    'file_validate_extensions' => array('csv'),    
  ),
);
    
    $form['submit'] = array(
      '#type' => 'submit',
      '#value' => t('Submit'),
    );

  return $form;
}




function itg_tv_schedule_form_submit($form, &$form_state) {
  global $user;
  $file=file_load($form_state['values']['file']);
  //unset($form_state['values']['file']);
  $file->status = FILE_STATUS_PERMANENT;
  file_save($file);
  file_usage_add($file,'user','user',$user->uid);
  drupal_set_message(t('The file has been submitted and saved, filename: @filename.', array('@filename' => $file->filename)));
}
?>