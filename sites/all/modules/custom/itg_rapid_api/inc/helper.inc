<?php
/*
 * Set the Firebase API Configuration 
 * 
 */

function firebase_config(){
    $firebase = array(
        'api-key' => 'AIzaSyDjXq0vdDZaa4HgEsdrlfLWXjevvIw7FFk',
        'dynamicLinkDomain' => 'peg3z.app.goo.gl',
        'androidPackageName' => 'com.indiatoday',
        'iosBundleId' => 'com.dci.indiatoday',
    );
    return $firebase;
}

/*
 * Common Function to create short url by firebase API 
 * args
 *  $url , longurl 
 *  return , shorturl 
 */

function firebase_short_url($url){
 
//get Default values  from config
$fire_base = firebase_config();    
$fire_base_url = 'https://firebasedynamiclinks.googleapis.com/v1/shortLinks?key='.$fire_base['api-key'].'';    
$base_config = '{
  "dynamicLinkInfo": {
    "dynamicLinkDomain": "'.$fire_base['dynamicLinkDomain'].'",
    "link": "'.$url.'",
    "androidInfo": {
      "androidPackageName": "'.$fire_base['androidPackageName'].'",
    },
    "iosInfo": {
      "iosBundleId": "'.$fire_base['iosBundleId'].'",
    }
  }
}';

$curl = curl_init();
curl_setopt($curl, CURLOPT_URL, $fire_base_url);
curl_setopt($curl, CURLOPT_HTTPHEADER, array('Content-Type: text/plain'));
curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($curl, CURLOPT_POSTFIELDS, $base_config);
$result = curl_exec($curl);
curl_close($curl);
$final_result = json_decode($result);
return $final_result->shortLink;
}

/*
 * Common Function to create short url of node
 * args
 *  $nid
 *  return , shorturl weburl
 */

function get_node_firebase_weburl($nid){
    // variable declaration
    global $base_url;
    $firebase_url = "";
    $alias = drupal_get_path_alias('node/'.$nid.'');
    $weburl = $base_url ."/". $alias;
    $firebase_url = firebase_short_url($weburl);
    return $firebase_url;
    
}